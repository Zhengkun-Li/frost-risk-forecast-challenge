# LSTM å’Œ Prophet æ¨¡å‹å·¥ä½œåŸç†è¯¦è§£

## ğŸ“Š ç›®å½•

1. [LSTM æ¨¡å‹](#lstm-æ¨¡å‹)
2. [Prophet æ¨¡å‹](#prophet-æ¨¡å‹)
3. [ä¸ç°æœ‰æ¨¡å‹çš„å¯¹æ¯”](#ä¸ç°æœ‰æ¨¡å‹çš„å¯¹æ¯”)
4. [åœ¨éœœå†»é¢„æµ‹ä¸­çš„åº”ç”¨](#åœ¨éœœå†»é¢„æµ‹ä¸­çš„åº”ç”¨)

---

## ğŸ”„ LSTM æ¨¡å‹

### 1. åŸºæœ¬åŸç†

**LSTM (Long Short-Term Memory)** æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¾ªç¯ç¥ç»ç½‘ç»œ (RNN)ï¼Œä¸“é—¨è®¾è®¡ç”¨æ¥å¤„ç†**åºåˆ—æ•°æ®**å’Œ**æ—¶é—´ä¾èµ–å…³ç³»**ã€‚

#### æ ¸å¿ƒç‰¹ç‚¹ï¼š

1. **è®°å¿†æœºåˆ¶**ï¼šLSTM æœ‰èƒ½åŠ›"è®°ä½"é•¿æœŸçš„å†å²ä¿¡æ¯
2. **åºåˆ—å¤„ç†**ï¼šå¯ä»¥å¤„ç†ä»»æ„é•¿åº¦çš„åºåˆ—æ•°æ®
3. **æ—¶é—´ä¾èµ–**ï¼šèƒ½å¤Ÿæ•æ‰æ—¶é—´åºåˆ—ä¸­çš„é•¿æœŸä¾èµ–å…³ç³»

### 2. åœ¨éœœå†»é¢„æµ‹ä¸­çš„å·¥ä½œæµç¨‹

#### æ•°æ®å‡†å¤‡é˜¶æ®µ

```python
# 1. è¾“å…¥æ•°æ®æ ¼å¼
# X: DataFrame with features (175 features)
# y: Series with target (temperature or frost label)

# 2. åºåˆ—æ„å»º
sequence_length = 24  # ä½¿ç”¨è¿‡å» 24 å°æ—¶çš„æ•°æ®
# å¯¹äºæ¯ä¸ªæ—¶é—´ç‚¹ tï¼Œè¾“å…¥æ˜¯ [t-23, t-22, ..., t-1, t] çš„ç‰¹å¾
# è¾“å‡ºæ˜¯æ—¶é—´ç‚¹ t çš„é¢„æµ‹å€¼

# 3. æ•°æ®é›†è½¬æ¢
# TimeSeriesDataset å°†æ•°æ®è½¬æ¢ä¸ºåºåˆ—æ ¼å¼ï¼š
# Input: (batch_size, sequence_length, num_features)
# Output: (batch_size, 1)
```

#### æ¨¡å‹æ¶æ„

```python
# LSTM ç½‘ç»œç»“æ„
LSTM(
    input_size=175,      # è¾“å…¥ç‰¹å¾æ•°é‡ (Top 175 features)
    hidden_size=64,      # éšè—å±‚å•å…ƒæ•°
    num_layers=2,        # LSTM å±‚æ•° (2 å±‚)
    dropout=0.2          # Dropout ç‡ (é˜²æ­¢è¿‡æ‹Ÿåˆ)
)
â†’ 
Linear(hidden_size, 1)   # å…¨è¿æ¥å±‚ï¼Œè¾“å‡ºé¢„æµ‹å€¼
```

**âœ… å½“å‰é…ç½®ï¼ˆå·²ä¼˜åŒ–ï¼‰**:
- `hidden_size`: **è‡ªåŠ¨è°ƒæ•´**ï¼ˆæ ¹æ®å†…å­˜ï¼š128 æˆ– 64ï¼‰
  - >=32GB: 128ï¼ˆæ ‡å‡†è®­ç»ƒï¼‰ï¼Œ64ï¼ˆLOSOï¼‰
  - <16GB: 64ï¼ˆæ ‡å‡†è®­ç»ƒï¼‰ï¼Œ32ï¼ˆLOSOï¼‰
- `num_layers=2`: âœ… åˆç†ï¼Œ2 å±‚é€šå¸¸è¶³å¤Ÿ
- `dropout=0.2`: âœ… åˆç†ï¼Œé»˜è®¤å€¼
- `sequence_length=24`: âœ… 24 å°æ—¶å†å²æ•°æ®ï¼Œé€‚åˆçŸ­æœŸå’Œä¸­æœŸé¢„æµ‹
- `batch_size`: **è‡ªåŠ¨è°ƒæ•´**ï¼ˆæ ¹æ®å†…å­˜ï¼š64/32/16ï¼‰
- `epochs`: âœ… 100ï¼ˆæ ‡å‡†ï¼‰æˆ– 50ï¼ˆLOSOï¼‰ï¼Œä½¿ç”¨æ—©åœæœºåˆ¶
- âœ… **ä¼˜åŒ–åŠŸèƒ½å·²å¯ç”¨**ï¼šæ—©åœã€å­¦ä¹ ç‡è°ƒåº¦ã€æ¢¯åº¦è£å‰ªã€æœ€ä½³æ¨¡å‹ä¿å­˜

#### è®­ç»ƒè¿‡ç¨‹

```python
# 1. å‰å‘ä¼ æ’­
# è¾“å…¥: (batch_size, 24, 175) - 24 å°æ—¶ Ã— 175 ä¸ªç‰¹å¾
# LSTM å¤„ç†åºåˆ—ï¼Œæ¯ä¸ªæ—¶é—´æ­¥å¤„ç†ä¸€æ¬¡
# è¾“å‡º: (batch_size, 64) - æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€
# å…¨è¿æ¥å±‚: (batch_size, 64) â†’ (batch_size, 1)

# 2. æŸå¤±è®¡ç®—
loss = MSE(predicted_temperature, actual_temperature)

# 3. åå‘ä¼ æ’­
# é€šè¿‡æ—¶é—´åå‘ä¼ æ’­ (BPTT) æ›´æ–°å‚æ•°
# ä½¿ç”¨ Adam ä¼˜åŒ–å™¨ï¼Œå­¦ä¹ ç‡ 0.001

# 4. è®­ç»ƒå¾ªç¯
for epoch in range(50):
    for batch in train_loader:
        # è®­ç»ƒä¸€ä¸ªæ‰¹æ¬¡
        loss.backward()
        optimizer.step()
```

#### é¢„æµ‹è¿‡ç¨‹

```python
# 1. åºåˆ—é¢„æµ‹
# å¯¹äºæ¯ä¸ªæ—¶é—´ç‚¹ï¼Œéœ€è¦è¿‡å» 24 å°æ—¶çš„æ•°æ®
for i in range(len(X) - sequence_length + 1):
    sequence = X[i:i+24]  # å– 24 å°æ—¶çš„æ•°æ®
    prediction = model(sequence)  # é¢„æµ‹ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹

# 2. å¤„ç†åºåˆ—å¼€å§‹éƒ¨åˆ†
# å‰ 23 ä¸ªæ—¶é—´ç‚¹æ²¡æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®
# ä½¿ç”¨ç¬¬ä¸€ä¸ªæœ‰æ•ˆé¢„æµ‹å€¼å¡«å……
```

### 3. ä¼˜åŠ¿ä¸å±€é™

#### ä¼˜åŠ¿ âœ…

1. **æ•æ‰é•¿æœŸä¾èµ–**ï¼šèƒ½å¤Ÿè®°ä½è¿‡å» 24 å°æ—¶çš„ä¿¡æ¯
2. **æ—¶é—´æ¨¡å¼è¯†åˆ«**ï¼šè‡ªåŠ¨å­¦ä¹ æ—¶é—´åºåˆ—ä¸­çš„æ¨¡å¼
3. **éçº¿æ€§å…³ç³»**ï¼šå¯ä»¥æ•æ‰å¤æ‚çš„éçº¿æ€§å…³ç³»

#### å±€é™ âš ï¸

1. **è®­ç»ƒæ—¶é—´é•¿**ï¼šéœ€è¦é€ä¸ªå¤„ç†åºåˆ—ï¼Œè®­ç»ƒè¾ƒæ…¢
2. **å†…å­˜éœ€æ±‚**ï¼šéœ€è¦ä¿å­˜åºåˆ—æ•°æ®ï¼Œå†…å­˜å ç”¨è¾ƒå¤§
3. **ä¸æ”¯æŒæ¦‚ç‡é¢„æµ‹**ï¼šåªèƒ½é¢„æµ‹è¿ç»­å€¼ï¼ˆæ¸©åº¦ï¼‰ï¼Œä¸èƒ½ç›´æ¥é¢„æµ‹æ¦‚ç‡
4. **éœ€è¦åºåˆ—æ•°æ®**ï¼šå¿…é¡»æœ‰è¿ç»­çš„æ—¶é—´åºåˆ—æ•°æ®

#### å‚æ•°ä¼˜åŒ–å»ºè®® âš™ï¸

**å½“å‰é…ç½®è¯„ä¼°**:
- `hidden_size=64`: âš ï¸ **å¯èƒ½åå°**ï¼Œå»ºè®®å¢åŠ åˆ° **128-256**
  - ç†ç”±: å¯¹äº 175 ä¸ªè¾“å…¥ç‰¹å¾ï¼Œ64 ä¸ªéšè—å•å…ƒå®¹é‡å¯èƒ½ä¸è¶³
  - å‚æ•°æ•°é‡: ~64 Ã— 175 Ã— 4 = ~44,800 (æ¯ä¸ªæ—¶é—´æ­¥)
- `num_layers=2`: âœ… åˆç†ï¼Œå¯ä»¥å°è¯• 3 å±‚
- `sequence_length=24`: âœ… çŸ­æœŸé¢„æµ‹åˆç†ï¼Œé•¿æœŸé¢„æµ‹å¯è€ƒè™‘ 48 å°æ—¶
- `epochs=50`: âš ï¸ **å¯èƒ½ä¸å¤Ÿ**ï¼Œå»ºè®®ä½¿ç”¨**æ—©åœæœºåˆ¶** (Early Stopping)
- `learning_rate=0.001`: âœ… åˆç†ï¼Œå»ºè®®ä½¿ç”¨**å­¦ä¹ ç‡è°ƒåº¦å™¨**

**å®é™…ä¼˜åŒ–é…ç½®ï¼ˆå·²å®ç°ï¼‰**:
```python
# æ ‡å‡†è®­ç»ƒ - è‡ªåŠ¨èµ„æºæ£€æµ‹
# ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜å¹¶æ ¹æ®èµ„æºè°ƒæ•´é…ç½®
import psutil
mem_gb = psutil.virtual_memory().total / (1024**3)
if mem_gb >= 32:
    hidden_size = 128
    batch_size = 64
elif mem_gb >= 16:
    hidden_size = 128
    batch_size = 32
else:
    hidden_size = 64
    batch_size = 16

frost_model_params = {
    "sequence_length": 24,      # ä½¿ç”¨ 24 å°æ—¶çš„å†å²æ•°æ®
    "hidden_size": hidden_size,  # è‡ªåŠ¨è°ƒæ•´: 128 (>=32GB) æˆ– 64 (<16GB)
    "num_layers": 2,            # 2 å±‚ LSTM
    "dropout": 0.2,             # Dropout ç‡
    "learning_rate": 0.001,     # åˆå§‹å­¦ä¹ ç‡
    "batch_size": batch_size,   # è‡ªåŠ¨è°ƒæ•´: 64 (>=32GB) æˆ– 32/16 (<32GB)
    "epochs": 100,              # æœ€å¤§è½®æ•°ï¼ˆä½¿ç”¨æ—©åœï¼Œé€šå¸¸ä¸ä¼šè·‘æ»¡ï¼‰
    # ä¼˜åŒ–åŠŸèƒ½ï¼ˆä½¿ç”¨ PyTorch å†…ç½®ï¼‰
    "early_stopping": True,     # âœ… æ—©åœæœºåˆ¶
    "patience": 10,             # éªŒè¯æŸå¤±ä¸å†ä¸‹é™ 10 è½®ååœæ­¢
    "min_delta": 1e-6,          # æœ€å°æ”¹è¿›é˜ˆå€¼
    "lr_scheduler": True,       # âœ… å­¦ä¹ ç‡è°ƒåº¦å™¨
    "lr_scheduler_patience": 5, # å­¦ä¹ ç‡è°ƒåº¦å™¨è€å¿ƒå€¼
    "lr_scheduler_factor": 0.5, # å­¦ä¹ ç‡è¡°å‡å› å­ï¼ˆæ¯æ¬¡å‡åŠï¼‰
    "gradient_clip": 1.0,       # âœ… æ¢¯åº¦è£å‰ªï¼Œé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸
    "save_best_model": True,    # âœ… ä¿å­˜éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹
}

# LOSO è®­ç»ƒ - ä½¿ç”¨æ›´å°çš„é…ç½®ï¼ˆéœ€è¦è®­ç»ƒ 72 ä¸ªæ¨¡å‹ï¼‰
# 18 ä¸ªç«™ç‚¹ Ã— 4 ä¸ªæ—¶é—´çª—å£ = 72 ä¸ªæ¨¡å‹
if mem_gb >= 32:
    hidden_size_loso = 64
    batch_size_loso = 32
elif mem_gb >= 16:
    hidden_size_loso = 64
    batch_size_loso = 16
else:
    hidden_size_loso = 32
    batch_size_loso = 16

frost_model_params_loso = {
    "sequence_length": 24,
    "hidden_size": hidden_size_loso,  # è¾ƒå°ï¼š64 æˆ– 32
    "num_layers": 2,
    "dropout": 0.2,
    "learning_rate": 0.001,
    "batch_size": batch_size_loso,    # è¾ƒå°ï¼š32 æˆ– 16
    "epochs": 50,                      # è¾ƒå°‘è½®æ•°ï¼Œä½†ä½¿ç”¨æ—©åœ
    "early_stopping": True,
    "patience": 8,                     # è¾ƒçŸ­çš„è€å¿ƒå€¼
    "min_delta": 1e-6,
    "lr_scheduler": True,
    "lr_scheduler_patience": 5,
    "lr_scheduler_factor": 0.5,
    "gradient_clip": 1.0,
    "save_best_model": True,
}
```

**ä½¿ç”¨çš„ PyTorch å†…ç½®åŠŸèƒ½**:
- âœ… `optim.lr_scheduler.ReduceLROnPlateau` - å­¦ä¹ ç‡è°ƒåº¦å™¨
- âœ… `torch.nn.utils.clip_grad_norm_` - æ¢¯åº¦è£å‰ª
- âœ… æ—©åœæœºåˆ¶ - è‡ªå®šä¹‰å®ç°ï¼ˆç®€å•é«˜æ•ˆï¼‰
- âœ… æœ€ä½³æ¨¡å‹ä¿å­˜ - åŸºäºéªŒè¯æŸå¤±è‡ªåŠ¨ä¿å­˜

**é…ç½®è§„åˆ™**:
| å†…å­˜ | æ ‡å‡†è®­ç»ƒ | LOSO è®­ç»ƒ |
|------|----------|-----------|
| >=32GB | hidden_size=128, batch_size=64 | hidden_size=64, batch_size=32 |
| 16-32GB | hidden_size=128, batch_size=32 | hidden_size=64, batch_size=16 |
| <16GB | hidden_size=64, batch_size=16 | hidden_size=32, batch_size=16 |

### 4. åœ¨éœœå†»é¢„æµ‹ä¸­çš„ç‰¹æ®Šå¤„ç†

```python
# LSTM åªé¢„æµ‹æ¸©åº¦ï¼ˆå›å½’ä»»åŠ¡ï¼‰
y_temp_pred = lstm_model.predict(X_test)

# éœœå†»æ¦‚ç‡ä»æ¸©åº¦è½¬æ¢è€Œæ¥
frost_threshold = 0.0  # éœœå†»é˜ˆå€¼ 0Â°C
scale = 2.0            # æ¦‚ç‡è½¬æ¢çš„é™¡å³­åº¦

# ä½¿ç”¨ sigmoid å‡½æ•°å°†æ¸©åº¦è½¬æ¢ä¸ºæ¦‚ç‡
y_frost_proba = 1.0 / (1.0 + np.exp((y_temp_pred - frost_threshold) / scale))

# éœœå†»é¢„æµ‹ï¼šå¦‚æœæ¸©åº¦ < 0Â°Cï¼Œåˆ™é¢„æµ‹ä¸ºéœœå†»
y_frost_pred = (y_temp_pred < frost_threshold).astype(int)
```

---

## ğŸ“ˆ Prophet æ¨¡å‹

### 1. åŸºæœ¬åŸç†

**Prophet** æ˜¯ Facebook å¼€å‘çš„æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹ï¼Œä¸“é—¨ç”¨äºå¤„ç†å…·æœ‰**æ˜æ˜¾å­£èŠ‚æ€§æ¨¡å¼**çš„æ—¶é—´åºåˆ—æ•°æ®ã€‚

#### æ ¸å¿ƒç‰¹ç‚¹ï¼š

1. **æ—¶é—´åºåˆ—åˆ†è§£**ï¼šå°†æ—¶é—´åºåˆ—åˆ†è§£ä¸ºè¶‹åŠ¿ã€å­£èŠ‚æ€§å’ŒèŠ‚å‡æ—¥æ•ˆåº”
2. **è‡ªåŠ¨å­£èŠ‚æ€§è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«å¹´ã€å‘¨ã€æ—¥çš„å­£èŠ‚æ€§æ¨¡å¼
3. **é²æ£’æ€§**ï¼šå¯¹ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼æœ‰è¾ƒå¥½çš„é²æ£’æ€§
4. **å¯è§£é‡Šæ€§**ï¼šå¯ä»¥è§£é‡Šæ¯ä¸ªç»„æˆéƒ¨åˆ†å¯¹é¢„æµ‹çš„è´¡çŒ®

### 2. æ—¶é—´åºåˆ—åˆ†è§£

Prophet å°†æ—¶é—´åºåˆ—åˆ†è§£ä¸ºï¼š

```
y(t) = g(t) + s(t) + h(t) + Îµ(t)

å…¶ä¸­ï¼š
- g(t): è¶‹åŠ¿é¡¹ (trend)
- s(t): å­£èŠ‚æ€§é¡¹ (seasonality)
- h(t): èŠ‚å‡æ—¥æ•ˆåº” (holidays)
- Îµ(t): è¯¯å·®é¡¹ (error)
```

#### è¶‹åŠ¿é¡¹ (Trend)

```python
# çº¿æ€§è¶‹åŠ¿æˆ–é€»è¾‘å¢é•¿è¶‹åŠ¿
# å¯¹äºéœœå†»é¢„æµ‹ï¼Œé€šå¸¸ä½¿ç”¨çº¿æ€§è¶‹åŠ¿
trend = growth_rate * time + offset
```

#### å­£èŠ‚æ€§é¡¹ (Seasonality)

```python
# ä¸‰ç§å­£èŠ‚æ€§æ¨¡å¼
yearly_seasonality = True   # å¹´åº¦å­£èŠ‚æ€§ï¼ˆæ˜¥å¤ç§‹å†¬ï¼‰
weekly_seasonality = True   # å‘¨å­£èŠ‚æ€§ï¼ˆå·¥ä½œæ—¥/å‘¨æœ«ï¼‰
daily_seasonality = True    # æ—¥å­£èŠ‚æ€§ï¼ˆç™½å¤©/å¤œæ™šï¼‰

# ä½¿ç”¨å‚…é‡Œå¶çº§æ•°å»ºæ¨¡
seasonality = Î£(a_n * cos(2Ï€n*t/P) + b_n * sin(2Ï€n*t/P))
```

#### èŠ‚å‡æ—¥æ•ˆåº” (Holidays)

```python
# å¯ä»¥æ·»åŠ ç‰¹å®šçš„èŠ‚å‡æ—¥æˆ–äº‹ä»¶
# å¯¹äºéœœå†»é¢„æµ‹ï¼Œå¯ä»¥æ·»åŠ ï¼š
# - å¯’æ½®äº‹ä»¶
# - æç«¯å¤©æ°”äº‹ä»¶
# - å­£èŠ‚æ€§è½¬æ¢ç‚¹
```

### 3. åœ¨éœœå†»é¢„æµ‹ä¸­çš„å·¥ä½œæµç¨‹

#### æ•°æ®å‡†å¤‡é˜¶æ®µ

```python
# 1. Prophet éœ€è¦ç‰¹å®šçš„æ•°æ®æ ¼å¼
prophet_df = pd.DataFrame({
    "ds": pd.to_datetime(X["Date"]),  # æ—¥æœŸåˆ— (å¿…é¡»)
    "y": y.values                       # ç›®æ ‡å€¼ (æ¸©åº¦æˆ–éœœå†»æ ‡ç­¾)
})

# 2. å¯ä»¥æ·»åŠ é¢å¤–çš„å›å½’å˜é‡
# ä¾‹å¦‚ï¼šæ¸©åº¦ã€æ¹¿åº¦ã€é£é€Ÿç­‰
for col in regressor_columns:
    prophet_df[col] = X[col].values
    model.add_regressor(col)
```

#### æ¨¡å‹è®­ç»ƒ

```python
# 1. åˆå§‹åŒ– Prophet æ¨¡å‹
model = Prophet(
    yearly_seasonality=True,   # å¹´åº¦å­£èŠ‚æ€§
    weekly_seasonality=True,   # å‘¨å­£èŠ‚æ€§
    daily_seasonality=True,    # æ—¥å­£èŠ‚æ€§
    seasonality_mode="multiplicative"  # å­£èŠ‚æ€§æ¨¡å¼ï¼ˆä¹˜æ³•ï¼‰
)

# 2. è®­ç»ƒæ¨¡å‹
model.fit(prophet_df)

# 3. Prophet å†…éƒ¨å¤„ç†
# - è‡ªåŠ¨è¯†åˆ«è¶‹åŠ¿
# - æ‹Ÿåˆå­£èŠ‚æ€§æ¨¡å¼
# - å­¦ä¹ å›å½’å˜é‡çš„æƒé‡
```

#### é¢„æµ‹è¿‡ç¨‹

```python
# 1. åˆ›å»ºæœªæ¥æ•°æ®æ¡†
future_df = pd.DataFrame({
    "ds": pd.to_datetime(X_test["Date"])
})

# 2. æ·»åŠ å›å½’å˜é‡
for col in regressor_columns:
    future_df[col] = X_test[col].values

# 3. è¿›è¡Œé¢„æµ‹
forecast = model.predict(future_df)
y_pred = forecast["yhat"].values  # é¢„æµ‹å€¼

# 4. Prophet è¿˜æä¾›ä¸ç¡®å®šæ€§åŒºé—´
y_lower = forecast["yhat_lower"].values  # ä¸‹é™
y_upper = forecast["yhat_upper"].values  # ä¸Šé™
```

### 4. ä¼˜åŠ¿ä¸å±€é™

#### ä¼˜åŠ¿ âœ…

1. **è‡ªåŠ¨å­£èŠ‚æ€§è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«å’Œå»ºæ¨¡å­£èŠ‚æ€§æ¨¡å¼
2. **é²æ£’æ€§å¼º**ï¼šå¯¹ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼æœ‰è¾ƒå¥½çš„å¤„ç†
3. **å¯è§£é‡Šæ€§**ï¼šå¯ä»¥åˆ†æè¶‹åŠ¿ã€å­£èŠ‚æ€§ç­‰ç»„æˆéƒ¨åˆ†
4. **ä¸ç¡®å®šæ€§é‡åŒ–**ï¼šæä¾›é¢„æµ‹çš„ä¸ç¡®å®šæ€§åŒºé—´
5. **æ˜“äºä½¿ç”¨**ï¼šAPI ç®€å•ï¼Œæ˜“äºé›†æˆ

#### å±€é™ âš ï¸

1. **éœ€è¦æ—¥æœŸåˆ—**ï¼šå¿…é¡»æä¾›æ—¥æœŸæ—¶é—´ä¿¡æ¯
2. **ä¸é€‚åˆçŸ­æœŸé¢„æµ‹**ï¼šæ›´é€‚åˆé•¿æœŸé¢„æµ‹ï¼ˆæ•°å‘¨/æ•°æœˆï¼‰
3. **è®¡ç®—æˆæœ¬**ï¼šå¯¹äºå¤§æ•°æ®é›†ï¼Œè®­ç»ƒæ—¶é—´è¾ƒé•¿
4. **ä¸æ”¯æŒæ¦‚ç‡é¢„æµ‹**ï¼šåªèƒ½é¢„æµ‹è¿ç»­å€¼ï¼Œä¸èƒ½ç›´æ¥é¢„æµ‹æ¦‚ç‡
5. **ç‰¹å¾åˆ©ç”¨æœ‰é™**ï¼šä¸»è¦ä¾èµ–æ—¶é—´ä¿¡æ¯ï¼Œå¯¹ç‰¹å¾å·¥ç¨‹çš„æ”¯æŒæœ‰é™

### 5. åœ¨éœœå†»é¢„æµ‹ä¸­çš„ç‰¹æ®Šå¤„ç†

```python
# Prophet åªé¢„æµ‹æ¸©åº¦ï¼ˆå›å½’ä»»åŠ¡ï¼‰
y_temp_pred = prophet_model.predict(X_test)

# éœœå†»æ¦‚ç‡ä»æ¸©åº¦è½¬æ¢è€Œæ¥ï¼ˆä¸ LSTM ç›¸åŒï¼‰
frost_threshold = 0.0
scale = 2.0
y_frost_proba = 1.0 / (1.0 + np.exp((y_temp_pred - frost_threshold) / scale))
y_frost_pred = (y_temp_pred < frost_threshold).astype(int)
```

---

## ğŸ”€ ä¸ç°æœ‰æ¨¡å‹çš„å¯¹æ¯”

### 1. æ¨¡å‹ç±»å‹å¯¹æ¯”

| ç‰¹æ€§ | LightGBM/XGBoost | LSTM | Prophet |
|------|------------------|------|---------|
| **æ¨¡å‹ç±»å‹** | æ¢¯åº¦æå‡æ ‘ | æ·±åº¦å­¦ä¹  (RNN) | æ—¶é—´åºåˆ—æ¨¡å‹ |
| **æ•°æ®æ ¼å¼** | è¡¨æ ¼æ•°æ® | åºåˆ—æ•°æ® | æ—¶é—´åºåˆ—æ•°æ® |
| **ç‰¹å¾å·¥ç¨‹** | éœ€è¦å¤§é‡ç‰¹å¾å·¥ç¨‹ | éœ€è¦åºåˆ—æ•°æ® | ä¸»è¦ä¾èµ–æ—¶é—´ä¿¡æ¯ |
| **è®­ç»ƒé€Ÿåº¦** | å¿« | æ…¢ | ä¸­ç­‰ |
| **å†…å­˜éœ€æ±‚** | ä¸­ç­‰ | é«˜ | ä¸­ç­‰ |
| **å¯è§£é‡Šæ€§** | ä¸­ç­‰ï¼ˆç‰¹å¾é‡è¦æ€§ï¼‰ | ä½ | é«˜ï¼ˆè¶‹åŠ¿/å­£èŠ‚æ€§åˆ†è§£ï¼‰ |
| **æ¦‚ç‡é¢„æµ‹** | æ”¯æŒ | ä¸æ”¯æŒï¼ˆéœ€è½¬æ¢ï¼‰ | ä¸æ”¯æŒï¼ˆéœ€è½¬æ¢ï¼‰ |
| **é•¿æœŸä¾èµ–** | æœ‰é™ï¼ˆé€šè¿‡ç‰¹å¾å·¥ç¨‹ï¼‰ | å¼ºï¼ˆåºåˆ—è®°å¿†ï¼‰ | å¼ºï¼ˆå­£èŠ‚æ€§æ¨¡å¼ï¼‰ |
| **å­£èŠ‚æ€§å¤„ç†** | éœ€è¦æ‰‹åŠ¨ç‰¹å¾å·¥ç¨‹ | è‡ªåŠ¨å­¦ä¹  | è‡ªåŠ¨è¯†åˆ« |

### 2. é€‚ç”¨åœºæ™¯å¯¹æ¯”

#### LightGBM/XGBoost é€‚åˆï¼š
- âœ… æœ‰å¤§é‡ç‰¹å¾å·¥ç¨‹çš„ç‰¹å¾
- âœ… éœ€è¦å¿«é€Ÿè®­ç»ƒå’Œé¢„æµ‹
- âœ… éœ€è¦æ¦‚ç‡é¢„æµ‹
- âœ… è¡¨æ ¼æ•°æ®æ ¼å¼

#### LSTM é€‚åˆï¼š
- âœ… æœ‰æ˜æ˜¾æ—¶é—´ä¾èµ–å…³ç³»
- âœ… éœ€è¦æ•æ‰é•¿æœŸæ¨¡å¼
- âœ… æœ‰è¶³å¤Ÿçš„è®­ç»ƒæ•°æ®
- âœ… åºåˆ—æ•°æ®æ ¼å¼

#### Prophet é€‚åˆï¼š
- âœ… æœ‰æ˜æ˜¾å­£èŠ‚æ€§æ¨¡å¼
- âœ… éœ€è¦å¯è§£é‡Šçš„é¢„æµ‹
- âœ… é•¿æœŸé¢„æµ‹ä»»åŠ¡
- âœ… æœ‰æ—¶é—´åºåˆ—æ•°æ®

### 3. åœ¨éœœå†»é¢„æµ‹ä¸­çš„è¡¨ç°é¢„æœŸ

#### LightGBM/XGBoost
- **ä¼˜åŠ¿**ï¼šå¿«é€Ÿè®­ç»ƒï¼Œé«˜ç²¾åº¦ï¼Œæ”¯æŒæ¦‚ç‡é¢„æµ‹
- **é€‚ç”¨**ï¼šæ ‡å‡†è®­ç»ƒå’Œ LOSO è¯„ä¼°
- **æ€§èƒ½**ï¼šROC-AUC > 0.98 (å½“å‰æœ€ä½³)

#### LSTM
- **ä¼˜åŠ¿**ï¼šå¯ä»¥æ•æ‰é•¿æœŸæ—¶é—´ä¾èµ–
- **æŒ‘æˆ˜**ï¼šè®­ç»ƒæ—¶é—´é•¿ï¼Œéœ€è¦åºåˆ—æ•°æ®
- **é¢„æœŸ**ï¼šå¯èƒ½åœ¨æŸäº›é•¿æœŸæ¨¡å¼ä¸Šè¡¨ç°æ›´å¥½

#### Prophet
- **ä¼˜åŠ¿**ï¼šè‡ªåŠ¨è¯†åˆ«å­£èŠ‚æ€§æ¨¡å¼ï¼ˆå†¬å­£éœœå†»æ›´é¢‘ç¹ï¼‰
- **æŒ‘æˆ˜**ï¼šéœ€è¦æ—¥æœŸåˆ—ï¼Œä¸é€‚åˆçŸ­æœŸé¢„æµ‹
- **é¢„æœŸ**ï¼šå¯èƒ½åœ¨é•¿æœŸè¶‹åŠ¿é¢„æµ‹ä¸Šè¡¨ç°æ›´å¥½

---

## ğŸ¯ åœ¨éœœå†»é¢„æµ‹ä¸­çš„åº”ç”¨

### 1. æ•°æ®æµç¨‹

```
åŸå§‹æ•°æ® (18 ä¸ªç«™ç‚¹)
    â†“
æ•°æ®æ¸…æ´—å’Œç‰¹å¾å·¥ç¨‹ (298 ä¸ªç‰¹å¾)
    â†“
ç‰¹å¾é€‰æ‹© (Top 175 ç‰¹å¾)
    â†“
    â”œâ”€â†’ LightGBM/XGBoost: ç›´æ¥ä½¿ç”¨è¡¨æ ¼æ•°æ®
    â”œâ”€â†’ LSTM: è½¬æ¢ä¸ºåºåˆ—æ•°æ® (24 å°æ—¶çª—å£)
    â””â”€â†’ Prophet: è½¬æ¢ä¸ºæ—¶é—´åºåˆ—æ ¼å¼ (Date + Target)
    â†“
æ¨¡å‹è®­ç»ƒ
    â†“
é¢„æµ‹
    â†“
    â”œâ”€â†’ æ¸©åº¦é¢„æµ‹ (å›å½’)
    â””â”€â†’ éœœå†»æ¦‚ç‡ (ä»æ¸©åº¦è½¬æ¢)
```

### 2. ç‰¹æ®Šå¤„ç†

#### LSTM åºåˆ—æ„å»º

```python
# å¯¹äºæ¯ä¸ªæ—¶é—´ç‚¹ t
# è¾“å…¥: [t-23, t-22, ..., t-1, t] çš„ 175 ä¸ªç‰¹å¾
# è¾“å‡º: æ—¶é—´ç‚¹ t çš„æ¸©åº¦é¢„æµ‹

# åºåˆ—é•¿åº¦: 24 å°æ—¶
# è¿™æ„å‘³ç€æ¨¡å‹å¯ä»¥"çœ‹åˆ°"è¿‡å» 24 å°æ—¶çš„æ‰€æœ‰ä¿¡æ¯
```

#### Prophet æ—¶é—´åºåˆ—æ ¼å¼

```python
# Prophet éœ€è¦ç‰¹å®šçš„æ•°æ®æ ¼å¼
prophet_df = pd.DataFrame({
    "ds": pd.to_datetime(X["Date"]),  # æ—¥æœŸæ—¶é—´
    "y": y.values,                     # ç›®æ ‡å€¼
    # å¯ä»¥æ·»åŠ å…¶ä»–ç‰¹å¾ä½œä¸ºå›å½’å˜é‡
    "temperature": X["Air Temp (C)"],
    "humidity": X["Rel Hum (%)"],
    # ...
})
```

### 3. é¢„æµ‹æµç¨‹

#### æ¸©åº¦é¢„æµ‹

```python
# 1. LSTM é¢„æµ‹
y_temp_pred_lstm = lstm_model.predict(X_test)

# 2. Prophet é¢„æµ‹
y_temp_pred_prophet = prophet_model.predict(X_test)

# 3. ä¸¤ç§æ¨¡å‹éƒ½é¢„æµ‹æ¸©åº¦ï¼ˆå›å½’ä»»åŠ¡ï¼‰
```

#### éœœå†»æ¦‚ç‡é¢„æµ‹

```python
# ç”±äº LSTM å’Œ Prophet ä¸æ”¯æŒæ¦‚ç‡é¢„æµ‹
# éœ€è¦ä½¿ç”¨æ¸©åº¦é¢„æµ‹æ¥ä¼°è®¡éœœå†»æ¦‚ç‡

# ä½¿ç”¨ sigmoid å‡½æ•°è½¬æ¢
frost_threshold = 0.0  # éœœå†»é˜ˆå€¼
scale = 2.0            # æ§åˆ¶æ¦‚ç‡æ›²çº¿çš„é™¡å³­åº¦

y_frost_proba = 1.0 / (1.0 + np.exp((y_temp_pred - frost_threshold) / scale))

# è¿™ä¸ªå…¬å¼çš„å«ä¹‰ï¼š
# - å½“æ¸©åº¦æ¥è¿‘ 0Â°C æ—¶ï¼Œæ¦‚ç‡æ¥è¿‘ 0.5
# - å½“æ¸©åº¦ä½äº 0Â°C æ—¶ï¼Œæ¦‚ç‡ > 0.5ï¼ˆæ›´å¯èƒ½éœœå†»ï¼‰
# - å½“æ¸©åº¦é«˜äº 0Â°C æ—¶ï¼Œæ¦‚ç‡ < 0.5ï¼ˆä¸å¤ªå¯èƒ½éœœå†»ï¼‰
```

### 4. è¯„ä¼°æŒ‡æ ‡

```python
# 1. æ¸©åº¦é¢„æµ‹è¯„ä¼°ï¼ˆå›å½’ï¼‰
MAE = mean_absolute_error(y_temp_true, y_temp_pred)
RMSE = root_mean_squared_error(y_temp_true, y_temp_pred)
RÂ² = r2_score(y_temp_true, y_temp_pred)

# 2. éœœå†»é¢„æµ‹è¯„ä¼°ï¼ˆåˆ†ç±»ï¼‰
ROC-AUC = roc_auc_score(y_frost_true, y_frost_proba)
Brier Score = brier_score_loss(y_frost_true, y_frost_proba)
ECE = expected_calibration_error(y_frost_true, y_frost_proba)
```

---

## ğŸ“ æ€»ç»“

### LSTM æ¨¡å‹

1. **å·¥ä½œåŸç†**ï¼šä½¿ç”¨å¾ªç¯ç¥ç»ç½‘ç»œå¤„ç†åºåˆ—æ•°æ®ï¼Œèƒ½å¤Ÿè®°å¿†é•¿æœŸä¿¡æ¯
2. **ä¼˜åŠ¿**ï¼šæ•æ‰é•¿æœŸæ—¶é—´ä¾èµ–ï¼Œè‡ªåŠ¨å­¦ä¹ æ—¶é—´æ¨¡å¼
3. **å±€é™**ï¼šè®­ç»ƒæ—¶é—´é•¿ï¼Œå†…å­˜éœ€æ±‚é«˜ï¼Œä¸æ”¯æŒæ¦‚ç‡é¢„æµ‹
4. **é€‚ç”¨**ï¼šæœ‰æ˜æ˜¾æ—¶é—´ä¾èµ–å…³ç³»çš„åºåˆ—æ•°æ®
5. **ä¼˜åŒ–é…ç½®**ï¼šâœ… **å·²å®ç°è‡ªåŠ¨èµ„æºæ£€æµ‹å’Œä¼˜åŒ–**
   - **è‡ªåŠ¨èµ„æºæ£€æµ‹**ï¼šæ ¹æ®ç³»ç»Ÿå†…å­˜è‡ªåŠ¨è°ƒæ•´ `hidden_size` (64-128) å’Œ `batch_size` (16-64)
   - **æ—©åœæœºåˆ¶**ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆï¼ŒèŠ‚çœè®­ç»ƒæ—¶é—´ï¼ˆpatience=10 æ ‡å‡†è®­ç»ƒï¼Œ8 LOSO è®­ç»ƒï¼‰
   - **å­¦ä¹ ç‡è°ƒåº¦å™¨**ï¼š`ReduceLROnPlateau` è‡ªåŠ¨è°ƒæ•´å­¦ä¹ ç‡ï¼ˆfactor=0.5ï¼Œpatience=5ï¼‰
   - **æ¢¯åº¦è£å‰ª**ï¼š`clip_grad_norm_` é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼ˆclip_value=1.0ï¼‰
   - **æœ€ä½³æ¨¡å‹ä¿å­˜**ï¼šè‡ªåŠ¨ä¿å­˜éªŒè¯é›†ä¸Šè¡¨ç°æœ€å¥½çš„æ¨¡å‹
   - **ä½¿ç”¨ PyTorch å†…ç½®åŠŸèƒ½**ï¼šæ— éœ€é¢å¤–ä¾èµ–åŒ…

### Prophet æ¨¡å‹

1. **å·¥ä½œåŸç†**ï¼šæ—¶é—´åºåˆ—åˆ†è§£ï¼Œè‡ªåŠ¨è¯†åˆ«è¶‹åŠ¿å’Œå­£èŠ‚æ€§æ¨¡å¼
2. **ä¼˜åŠ¿**ï¼šè‡ªåŠ¨å­£èŠ‚æ€§è¯†åˆ«ï¼Œå¯è§£é‡Šæ€§å¼ºï¼Œé²æ£’æ€§å¥½
3. **å±€é™**ï¼šéœ€è¦æ—¥æœŸåˆ—ï¼Œä¸é€‚åˆçŸ­æœŸé¢„æµ‹ï¼Œä¸æ”¯æŒæ¦‚ç‡é¢„æµ‹
4. **é€‚ç”¨**ï¼šæœ‰æ˜æ˜¾å­£èŠ‚æ€§æ¨¡å¼çš„æ—¶é—´åºåˆ—æ•°æ®

### åœ¨éœœå†»é¢„æµ‹ä¸­çš„åº”ç”¨

1. **LSTM**ï¼šåˆ©ç”¨è¿‡å» 24 å°æ—¶çš„æ•°æ®é¢„æµ‹æœªæ¥æ¸©åº¦ï¼Œé€‚åˆæ•æ‰çŸ­æœŸæ—¶é—´ä¾èµ–
   - âœ… **å·²ä¼˜åŒ–**ï¼šè‡ªåŠ¨èµ„æºæ£€æµ‹ï¼Œæ—©åœæœºåˆ¶ï¼Œå­¦ä¹ ç‡è°ƒåº¦ï¼Œæ¢¯åº¦è£å‰ª
   - âœ… **é…ç½®**ï¼šæ ¹æ®ç³»ç»Ÿå†…å­˜è‡ªåŠ¨è°ƒæ•´ï¼ˆhidden_size: 64-128, batch_size: 16-64ï¼‰
   - âœ… **è®­ç»ƒæ•ˆç‡**ï¼šä½¿ç”¨æ—©åœæœºåˆ¶ï¼Œé€šå¸¸ä¸ä¼šè·‘æ»¡ 100 è½®

2. **Prophet**ï¼šåˆ©ç”¨å­£èŠ‚æ€§æ¨¡å¼ï¼ˆå†¬å­£éœœå†»æ›´é¢‘ç¹ï¼‰é¢„æµ‹é•¿æœŸè¶‹åŠ¿
   - âš ï¸ **æ³¨æ„**ï¼šéœ€è¦æ—¥æœŸåˆ—ï¼ˆDateï¼‰ï¼Œå¯èƒ½éœ€è¦åœ¨ç‰¹å¾å·¥ç¨‹ä¸­ä¿ç•™

3. **ç‰¹æ®Šå¤„ç†**ï¼šä¸¤ç§æ¨¡å‹éƒ½åªé¢„æµ‹æ¸©åº¦ï¼Œéœœå†»æ¦‚ç‡ä»æ¸©åº¦è½¬æ¢è€Œæ¥
   ```python
   # ä½¿ç”¨ sigmoid å‡½æ•°è½¬æ¢
   frost_threshold = 0.0  # éœœå†»é˜ˆå€¼
   scale = 2.0            # æ§åˆ¶æ¦‚ç‡æ›²çº¿çš„é™¡å³­åº¦
   y_frost_proba = 1.0 / (1.0 + np.exp((y_temp_pred - frost_threshold) / scale))
   ```

### å»ºè®®

1. **LSTM**ï¼šé€‚åˆå¤„ç†æœ‰æ˜æ˜¾æ—¶é—´ä¾èµ–çš„çŸ­æœŸé¢„æµ‹ï¼ˆ3h, 6hï¼‰
   - âœ… **å·²ä¼˜åŒ–**ï¼šé…ç½®å·²æ ¹æ®ç³»ç»Ÿèµ„æºè‡ªåŠ¨è°ƒæ•´
   - âœ… **æ¨è**ï¼šä½¿ç”¨ä¼˜åŒ–åçš„é…ç½®ï¼ŒåŒ…å«æ—©åœã€å­¦ä¹ ç‡è°ƒåº¦ç­‰åŠŸèƒ½

2. **Prophet**ï¼šé€‚åˆå¤„ç†æœ‰æ˜æ˜¾å­£èŠ‚æ€§æ¨¡å¼çš„é•¿æœŸé¢„æµ‹ï¼ˆ12h, 24hï¼‰
   - âš ï¸ **æ³¨æ„**ï¼šç¡®ä¿ç‰¹å¾å·¥ç¨‹ä¸­ä¿ç•™äº† Date åˆ—

3. **LightGBM/XGBoost**ï¼šä»ç„¶æ˜¯å½“å‰æœ€ä½³é€‰æ‹©ï¼Œå¿«é€Ÿä¸”é«˜ç²¾åº¦
   - æ€§èƒ½ï¼šROC-AUC > 0.98ï¼ˆå½“å‰æœ€ä½³ï¼‰

---

**æœ€åæ›´æ–°**: 2025-11-14  
**ä½œè€…**: AI Assistant  
**é¡¹ç›®**: Frost Risk Forecast Challenge


/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names
  warnings.warn(
/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names
  warnings.warn(
/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names
  warnings.warn(
/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names
  warnings.warn(
/home/zhengkun-li/frost-risk-forecast-challenge/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
Output directory: experiments/ensemble/top175_features

============================================================
Step 1: Loading Data
============================================================
Loading 18 station files from /home/zhengkun-li/frost-risk-forecast-challenge/data/raw/frost-risk-forecast-challenge/stations...
  Loaded 5/18 files...  Loaded 10/18 files...  Loaded 15/18 files...  Loaded 18/18 files...
Combining 18 station DataFrames...
Combined data: 2367360 rows, 26 columns
Stations: 18
Loaded 2367360 rows, 26 columns
Optimizing data types to reduce memory...
Memory usage after optimization: 1.50 GB

============================================================
Step 2: Cleaning Data
============================================================
After cleaning: 2367360 rows

============================================================
Step 3: Feature Engineering
============================================================
After feature engineering: 2367360 rows, 313 columns
Memory usage: 3.95 GB
Optimizing feature data types...
Memory usage after optimization: 3.95 GB

============================================================
Step 4: Creating Frost Labels
============================================================
  3h horizon: 20579.0/2367360 frost events (0.87%)
  6h horizon: 20579.0/2367360 frost events (0.87%)
  12h horizon: 20579.0/2367360 frost events (0.87%)
  24h horizon: 20579.0/2367360 frost events (0.87%)

Saved labeled data to experiments/ensemble/top175_features/labeled_data.parquet

Using top 175 features based on importance
  Importance file: /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv

============================================================
Training models for 3h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2367306
Frost events: 20579.0 (0.87%)
Train: 1657078, Val: 355087, Test: 355090

Training classification model for frost probability...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...
Training regression model for temperature...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9964
brier_score: 0.0026
ece: 0.0009
f1: 0.6605
fn: 661
fp: 622
pr_auc: 0.7290
precision: 0.6674
recall: 0.6537
roc_auc: 0.9971
tn: 352559
tp: 1248

Regression Metrics (Temperature):
mae: 1.1448
mape: 12.3682
r2: 0.9703
rmse: 1.5245
Model saved to experiments/ensemble/top175_features/horizon_3h/frost_classifier/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_3h/frost_classifier/lightgbm_model/config.json
Model saved to experiments/ensemble/top175_features/horizon_3h/temp_regressor/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_3h/temp_regressor/lightgbm_model/config.json

Generating reliability diagram...

============================================================
Training models for 6h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2367252
Frost events: 20579.0 (0.87%)
Train: 1657004, Val: 355070, Test: 355076

Training classification model for frost probability...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...
Training regression model for temperature...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9948
brier_score: 0.0037
ece: 0.0018
f1: 0.5231
fn: 896
fp: 951
pr_auc: 0.5615
precision: 0.5158
recall: 0.5306
roc_auc: 0.9938
tn: 352216
tp: 1013

Regression Metrics (Temperature):
mae: 1.5517
mape: 17.0293
r2: 0.9477
rmse: 2.0230
Model saved to experiments/ensemble/top175_features/horizon_6h/frost_classifier/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_6h/frost_classifier/lightgbm_model/config.json
Model saved to experiments/ensemble/top175_features/horizon_6h/temp_regressor/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_6h/temp_regressor/lightgbm_model/config.json

Generating reliability diagram...

============================================================
Training models for 12h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2367144
Frost events: 20579.0 (0.87%)
Train: 1656856, Val: 355036, Test: 355048

Training classification model for frost probability...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...
Training regression model for temperature...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9948
brier_score: 0.0039
ece: 0.0022
f1: 0.4722
fn: 1081
fp: 770
pr_auc: 0.5072
precision: 0.5181
recall: 0.4337
roc_auc: 0.9899
tn: 352369
tp: 828

Regression Metrics (Temperature):
mae: 1.8067
mape: 20.3500
r2: 0.9292
rmse: 2.3539
Model saved to experiments/ensemble/top175_features/horizon_12h/frost_classifier/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_12h/frost_classifier/lightgbm_model/config.json
Model saved to experiments/ensemble/top175_features/horizon_12h/temp_regressor/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_12h/temp_regressor/lightgbm_model/config.json

Generating reliability diagram...

============================================================
Training models for 24h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2366928
Frost events: 20579.0 (0.87%)
Train: 1656561, Val: 354967, Test: 354992

Training classification model for frost probability...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...
Training regression model for temperature...
Training lightgbm model (1/3)...
Training xgboost model (2/3)...
Training catboost model (3/3)...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9929
brier_score: 0.0054
ece: 0.0047
f1: 0.3786
fn: 1140
fp: 1384
pr_auc: 0.3466
precision: 0.3572
recall: 0.4028
roc_auc: 0.9847
tn: 351699
tp: 769

Regression Metrics (Temperature):
mae: 1.9283
mape: 22.8662
r2: 0.9197
rmse: 2.5062
Model saved to experiments/ensemble/top175_features/horizon_24h/frost_classifier/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_24h/frost_classifier/lightgbm_model/config.json
Model saved to experiments/ensemble/top175_features/horizon_24h/temp_regressor/lightgbm_model/model.pkl
Config saved to experiments/ensemble/top175_features/horizon_24h/temp_regressor/lightgbm_model/config.json

Generating reliability diagram...

============================================================
Summary Report
============================================================

3h Horizon:
  Frost - Brier: 0.0026, ECE: 0.0009, ROC-AUC: 0.9971
  Temp  - MAE: 1.1448, RMSE: 1.5245, R²: 0.9703

6h Horizon:
  Frost - Brier: 0.0037, ECE: 0.0018, ROC-AUC: 0.9938
  Temp  - MAE: 1.5517, RMSE: 2.0230, R²: 0.9477

12h Horizon:
  Frost - Brier: 0.0039, ECE: 0.0022, ROC-AUC: 0.9899
  Temp  - MAE: 1.8067, RMSE: 2.3539, R²: 0.9292

24h Horizon:
  Frost - Brier: 0.0054, ECE: 0.0047, ROC-AUC: 0.9847
  Temp  - MAE: 1.9283, RMSE: 2.5062, R²: 0.9197

✅ Training completed!
Results saved to: experiments/ensemble/top175_features

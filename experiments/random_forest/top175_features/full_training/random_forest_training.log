Traceback (most recent call last):
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 856, in main
    result = train_models_for_horizon(
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 654, in train_models_for_horizon
    plotter.plot_reliability_diagram(
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 327, in plot_reliability_diagram
    self._plot_reliability_matplotlib(y_true, y_proba, n_bins, title, save_path, show)
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 335, in _plot_reliability_matplotlib
    reliability_data = MetricsCalculator.calculate_reliability_data(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/evaluation/metrics.py", line 249, in calculate_reliability_data
    actual_freqs.append(y_true[in_bin].mean())
                        ~~~~~~^^^^^^^^
IndexError: too many indices for array: array is 1-dimensional, but 2 were indexed
Traceback (most recent call last):
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 856, in main
    result = train_models_for_horizon(
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 654, in train_models_for_horizon
    plotter.plot_reliability_diagram(
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 327, in plot_reliability_diagram
    self._plot_reliability_matplotlib(y_true, y_proba, n_bins, title, save_path, show)
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 335, in _plot_reliability_matplotlib
    reliability_data = MetricsCalculator.calculate_reliability_data(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/evaluation/metrics.py", line 249, in calculate_reliability_data
    actual_freqs.append(y_true[in_bin].mean())
                        ~~~~~~^^^^^^^^
IndexError: too many indices for array: array is 1-dimensional, but 2 were indexed
Traceback (most recent call last):
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 856, in main
    result = train_models_for_horizon(
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 654, in train_models_for_horizon
    plotter.plot_reliability_diagram(
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 327, in plot_reliability_diagram
    self._plot_reliability_matplotlib(y_true, y_proba, n_bins, title, save_path, show)
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 335, in _plot_reliability_matplotlib
    reliability_data = MetricsCalculator.calculate_reliability_data(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/evaluation/metrics.py", line 249, in calculate_reliability_data
    actual_freqs.append(y_true[in_bin].mean())
                        ~~~~~~^^^^^^^^
IndexError: too many indices for array: array is 1-dimensional, but 2 were indexed
Traceback (most recent call last):
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 856, in main
    result = train_models_for_horizon(
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/scripts/train/train_frost_forecast.py", line 654, in train_models_for_horizon
    plotter.plot_reliability_diagram(
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 327, in plot_reliability_diagram
    self._plot_reliability_matplotlib(y_true, y_proba, n_bins, title, save_path, show)
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/visualization/plots.py", line 335, in _plot_reliability_matplotlib
    reliability_data = MetricsCalculator.calculate_reliability_data(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/zhengkun-li/frost-risk-forecast-challenge/src/evaluation/metrics.py", line 249, in calculate_reliability_data
    actual_freqs.append(y_true[in_bin].mean())
                        ~~~~~~^^^^^^^^
IndexError: too many indices for array: array is 1-dimensional, but 2 were indexed
Output directory: experiments/random_forest/top175_features

============================================================
Step 1: Loading Data
============================================================
Loading 18 station files from /home/zhengkun-li/frost-risk-forecast-challenge/data/raw/frost-risk-forecast-challenge/stations...
  Loaded 5/18 files...  Loaded 10/18 files...  Loaded 15/18 files...  Loaded 18/18 files...
Combining 18 station DataFrames...
Combined data: 2367360 rows, 26 columns
Stations: 18
Loaded 2367360 rows, 26 columns
Optimizing data types to reduce memory...
Memory usage after optimization: 1.50 GB

============================================================
Step 2: Cleaning Data
============================================================
After cleaning: 2367360 rows

============================================================
Step 3: Feature Engineering
============================================================
After feature engineering: 2367360 rows, 313 columns
Memory usage: 3.95 GB
Optimizing feature data types...
Memory usage after optimization: 3.95 GB

============================================================
Step 4: Creating Frost Labels
============================================================
  3h horizon: 20579.0/2367360 frost events (0.87%)
  6h horizon: 20579.0/2367360 frost events (0.87%)
  12h horizon: 20579.0/2367360 frost events (0.87%)
  24h horizon: 20579.0/2367360 frost events (0.87%)

Saved labeled data to experiments/random_forest/top175_features/labeled_data.parquet

Using top 175 features based on importance
  Importance file: /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv

============================================================
Training models for 3h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2367306
Frost events: 20579.0 (0.87%)
Train: 1657078, Val: 355087, Test: 355090

Training classification model for frost probability...
Training regression model for temperature...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9964
brier_score: 0.0027
ece: nan
f1: 0.6303
fn: 805
fp: 490
pr_auc: nan
precision: 0.6926
recall: 0.5783
roc_auc: nan
tn: 352691
tp: 1104

Regression Metrics (Temperature):
mae: 1.4243
mape: 15.4966
r2: 0.9547
rmse: 1.8832

Generating reliability diagram...
❌ Error training 3h model: too many indices for array: array is 1-dimensional, but 2 were indexed

============================================================
Training models for 6h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2367252
Frost events: 20579.0 (0.87%)
Train: 1657004, Val: 355070, Test: 355076

Training classification model for frost probability...
Training regression model for temperature...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9952
brier_score: 0.0036
ece: nan
f1: 0.5016
fn: 1045
fp: 672
pr_auc: nan
precision: 0.5625
recall: 0.4526
roc_auc: nan
tn: 352495
tp: 864

Regression Metrics (Temperature):
mae: 1.9565
mape: 21.3876
r2: 0.9174
rmse: 2.5419

Generating reliability diagram...
❌ Error training 6h model: too many indices for array: array is 1-dimensional, but 2 were indexed

============================================================
Training models for 12h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2367144
Frost events: 20579.0 (0.87%)
Train: 1656856, Val: 355036, Test: 355048

Training classification model for frost probability...
Training regression model for temperature...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9952
brier_score: 0.0039
ece: nan
f1: 0.3957
fn: 1355
fp: 337
pr_auc: nan
precision: 0.6218
recall: 0.2902
roc_auc: nan
tn: 352802
tp: 554

Regression Metrics (Temperature):
mae: 2.0049
mape: 24.5105
r2: 0.9124
rmse: 2.6179

Generating reliability diagram...
❌ Error training 12h model: too many indices for array: array is 1-dimensional, but 2 were indexed

============================================================
Training models for 24h horizon
============================================================
  Applying feature selection...
    Original features: 298
    Loaded feature importance from /home/zhengkun-li/frost-risk-forecast-challenge/experiments/lightgbm/feature_importance/feature_importance_3h_all.csv
  After selecting by importance: 175 features
    Selected features: 175
    Removed features: 123
Features: 175
Samples: 2366928
Frost events: 20579.0 (0.87%)
Train: 1656561, Val: 354967, Test: 354992

Training classification model for frost probability...
Training regression model for temperature...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9944
brier_score: 0.0045
ece: nan
f1: 0.3654
fn: 1334
fp: 663
pr_auc: nan
precision: 0.4645
recall: 0.3012
roc_auc: nan
tn: 352420
tp: 575

Regression Metrics (Temperature):
mae: 1.9927
mape: 24.7496
r2: 0.9132
rmse: 2.6058

Generating reliability diagram...
❌ Error training 24h model: too many indices for array: array is 1-dimensional, but 2 were indexed

============================================================
Summary Report
============================================================

✅ Training completed!
Results saved to: experiments/random_forest/top175_features

/home/zhengkun-li/.local/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMClassifier was fitted with feature names
  warnings.warn(
/home/zhengkun-li/.local/lib/python3.12/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but LGBMRegressor was fitted with feature names
  warnings.warn(
Output directory: experiments/test_new_features_100k

============================================================
Step 1: Loading Data
============================================================
Loading 18 station files from /home/zhengkun-li/frost-risk-forecast-challenge/data/raw/frost-risk-forecast-challenge/stations...
  Loaded 5/18 files...  Loaded 10/18 files...  Loaded 15/18 files...  Loaded 18/18 files...
Combining 18 station DataFrames...
Combined data: 2367360 rows, 26 columns
Stations: 18
Loaded 2367360 rows, 26 columns
Optimizing data types to reduce memory...
Memory usage after optimization: 1.50 GB
Sampled 100000 rows

============================================================
Step 2: Cleaning Data
============================================================
After cleaning: 100000 rows

============================================================
Step 3: Feature Engineering
============================================================
After feature engineering: 100000 rows, 313 columns
Memory usage: 0.17 GB
Optimizing feature data types...
Memory usage after optimization: 0.17 GB

============================================================
Step 4: Creating Frost Labels
============================================================
  3h horizon: 887.0/100000 frost events (0.89%)

Saved labeled data to experiments/test_new_features_100k/labeled_data.parquet

============================================================
Training models for 3h horizon
============================================================
Features: 298
Samples: 99946
Frost events: 887.0 (0.89%)
Train: 69926, Val: 14983, Test: 14986

Training classification model for frost probability...
Training regression model for temperature...

Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9947
brier_score: 0.0051
ece: 0.0033
f1: 0.0000
fn: 78
fp: 1
pr_auc: 0.0612
precision: 0.0000
recall: 0.0000
roc_auc: 0.9132
tn: 14907
tp: 0

Regression Metrics (Temperature):
mae: 4.5951
mape: 61.3538
r2: 0.5993
rmse: 5.6029
Model saved to experiments/test_new_features_100k/horizon_3h/frost_classifier/model.pkl
Config saved to experiments/test_new_features_100k/horizon_3h/frost_classifier/config.json
Model saved to experiments/test_new_features_100k/horizon_3h/temp_regressor/model.pkl
Config saved to experiments/test_new_features_100k/horizon_3h/temp_regressor/config.json

Generating reliability diagram...

============================================================
Summary Report
============================================================

3h Horizon:
  Frost - Brier: 0.0051, ECE: 0.0033, ROC-AUC: 0.9132
  Temp  - MAE: 4.5951, RMSE: 5.6029, R²: 0.5993

✅ Training completed!
Results saved to: experiments/test_new_features_100k
